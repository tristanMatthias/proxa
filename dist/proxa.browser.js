!function(e,o){"object"==typeof exports&&"undefined"!=typeof module?o(exports):"function"==typeof define&&define.amd?define(["exports"],o):o((e=e||self).window=e.window||{})}(this,(function(e){"use strict";const o=Symbol("proxa"),t=Symbol("proxaUpdate"),r=Symbol("proxaCallbacks"),n=Symbol("proxaPropCallbacks"),s=Symbol("proxaParent"),i=Symbol("proxaParentProperty"),c=Symbol("proxaIsArray"),a=[o,t,r,n,s,i,c,"toJSON"],f=e=>{if(e[o])return e;const r=new Proxy(e,{get(e,t){if(a.includes(t))return e[t];const n=e[t];if(n&&"object"==typeof n&&!n[o]){const o=e[t]=f(n);l(o,e[t]instanceof Array,r,t)}return e[t]},set:(e,o,r)=>(e[o]===r||(e[o]=r,a.includes(o)||e[t](o,r,o)),!0)});return r},l=(e,f,l,p)=>{if(!e[o]){if(e[o]=!0,e[r]=[],e[n]=new Map,e[t]=(o,c,a)=>{var f;e[r].forEach(t=>t(e,o,c,a)),null===(f=e[n].get(o))||void 0===f||f.forEach(t=>t(e,o,c,a)),e[s]&&e[s][t](e[i],e,[a,o].join("."))},l){if(!p)throw new Error("Unknown parentProperty");e[s]=l,e[i]=p}f&&(e[c]=!0),Object.defineProperty(e,"toJSON",{enumerable:!1,writable:!1,value:()=>{const t=Object.assign({},e);return a.forEach(e=>delete t[e]),Object.entries(t).forEach(([e,r])=>{r&&"object"==typeof r&&r[o]&&(t[e]=r.toJSON())}),e[c]?Object.entries(t).reduce((e,[o,t])=>(/^\d+$/.test(o)&&e.push(t),e),[]):(delete t.toJSON,t)}})}};e.off=(e,o,t)=>{const s=e;if(t){const e=s[n].get(t);if(!e)throw new Error(`Could not find any callbacks for property '${t}'`);const r=e.indexOf(o);if(r<0)throw new Error(`Callback does not exist on property '${t}' for this object`);e.splice(r,1)}else{const e=s[r].indexOf(o);if(e<0)throw new Error("Callback does not exist on this object");s[r].splice(e,1)}return e},e.proxa=(e,t,s)=>{let i;return e[o]?i=e:(i=f(e),l(i,e instanceof Array)),t&&((e,o,t)=>{if(t||e[r].includes(o)){if(t){let r=e[n].get(t);r||(r=[],e[n].set(t,r)),r.push(o)}}else e[r].push(o)})(i,t,s),i},Object.defineProperty(e,"__esModule",{value:!0})}));
