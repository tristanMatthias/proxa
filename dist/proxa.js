"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=Symbol("proxa"),r=Symbol("proxaUpdate"),o=Symbol("proxaCallbacks"),t=Symbol("proxaPropCallbacks"),n=Symbol("proxaParent"),s=Symbol("proxaParentProperty"),a=Symbol("proxaIsArray"),c=[e,r,o,t,n,s,a,"toJSON"],l=o=>{if(o[e])return o;const t=new Proxy(o,{get(r,o){if(c.includes(o))return r[o];const n=r[o];if(n&&"object"==typeof n&&!n[e]){const e=r[o]=l(n);i(e,r[o]instanceof Array,t,o)}return r[o]},set:(e,o,t)=>(e[o]===t||(e[o]=t,c.includes(o)||e[r](o,t,o)),!0)});return t},i=(l,i,p,f)=>{if(!l[e]){if(l[e]=!0,l[o]=[],l[t]=new Map,l[r]=(e,a,c)=>{var i;l[o].forEach(r=>r(l,e,a,c)),null===(i=l[t].get(e))||void 0===i||i.forEach(r=>r(l,e,a,c)),l[n]&&l[n][r](l[s],l,[c,e].join("."))},p){if(!f)throw new Error("Unknown parentProperty");l[n]=p,l[s]=f}i&&(l[a]=!0),Object.defineProperty(l,"toJSON",{enumerable:!1,writable:!1,value:()=>{const r=Object.assign({},l);return c.forEach(e=>delete r[e]),Object.entries(r).forEach(([o,t])=>{t&&"object"==typeof t&&t[e]&&(r[o]=t.toJSON())}),l[a]?Object.entries(r).reduce((e,[r,o])=>(/^\d+$/.test(r)&&e.push(o),e),[]):(delete r.toJSON,r)}})}};exports.off=(e,r,n)=>{const s=e;if(n){const e=s[t].get(n);if(!e)throw new Error(`Could not find any callbacks for property '${n}'`);const o=e.indexOf(r);if(o<0)throw new Error(`Callback does not exist on property '${n}' for this object`);e.splice(o,1)}else{const e=s[o].indexOf(r);if(e<0)throw new Error("Callback does not exist on this object");s[o].splice(e,1)}return e},exports.proxa=(r,n,s)=>{let a;return r[e]?a=r:(a=l(r),i(a,r instanceof Array)),n&&((e,r,n)=>{if(n||e[o].includes(r)){if(n){let o=e[t].get(n);o||(o=[],e[t].set(n,o)),o.push(r)}}else e[o].push(r)})(a,n,s),a};
